sudo: required

language: php
php:
  - '7.1.6'

services:
  - docker

# env:


# build lifecycle - https://docs.travis-ci.com/user/customizing-the-build/
# (OPTIONAL) Install apt addons
# (OPTIONAL) Install cache components
# before_install
# install
# before_script
# script
# (OPTIONAL) before_cache (for cleaning up cache)
# after_success or after_failure
# (OPTIONAL) before_deploy
# (OPTIONAL) deploy
# (OPTIONAL) after_deploy
# after_script
# before_install:
#   - set -e

# install:
#
# after_install:
#
# before_script:
#
# script:
#
# after_script:



after_success:
  - set -e
  - if [[ $TRAVIS_BRANCH == "master" ]]; then
    docker --version;
    docker version;
    docker info;
    pip install --user awscli;
    export PATH=$PATH:$HOME/.local/bin;
    eval $(aws ecr get-login --no-include-email --region ${AWS_DEFAULT_REGION});
    docker build -t ${DOCKER_IMAGE} .;
    docker tag ${DOCKER_IMAGE}:latest ${ECR_REPOSITORY_DOMAIN}/${DOCKER_IMAGE}:latest;
    docker push ${ECR_REPOSITORY_DOMAIN}/${DOCKER_IMAGE}:latest;
    fi

# after_failure:

# before_deploy:

# deploy:

# after_deploy:

# after_script:
